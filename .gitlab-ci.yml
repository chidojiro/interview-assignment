stages:
  - build

build:
  stage: build
  allow_failure: false
  only:
    - main
    - tags
  tags:
    - randstad-bluex
  script: |
    git remote add codecommit /fake-temp-url || true
    
    # DF account
    git remote set-url codecommit https://git-codecommit.eu-west-1.amazonaws.com/v1/repos/git-df-prd-bluex-lib-react-components
    AWS_PROFILE="bluex-codecommit" git push codecommit HEAD:refs/heads/$CI_COMMIT_REF_NAME
    
    # Bluex account
    git remote set-url codecommit https://git-codecommit.eu-west-1.amazonaws.com/v1/repos/git-bluex-prd-bx-lib-react-components
    git push codecommit HEAD:refs/heads/$CI_COMMIT_REF_NAME
    
    echo "Environment is"
    echo ${ENVIRONMENT}
    echo "Global branch is"
    echo ${CI_MERGE_REQUEST_TARGET_BRANCH_NAME}
    echo "Pipeline source is"
    echo ${CI_PIPELINE_SOURCE}

#    aws s3 sync src/i18n/ s3://s3-bluex-dta-bx-dev2-localization/components_lib/default/ --exclude "*" --include "??.json"
#    aws s3 sync src/i18n/ s3://s3-bluex-dta-bx-ppr2-localization/components_lib/default/ --exclude "*" --include "??.json"
#    aws s3 sync src/i18n/ s3://s3-bluex-dta-bx-tst3-localization/components_lib/default/ --exclude "*" --include "??.json"
